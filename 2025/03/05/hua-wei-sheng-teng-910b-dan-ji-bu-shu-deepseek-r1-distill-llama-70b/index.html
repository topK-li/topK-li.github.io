<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="华为昇腾910b单机部署DeepSeek-R1-Distill-Llama-70B, 你的朋友的博客">
    <meta name="description" content="华为昇腾8卡910b单机部署DeepSeek-R1-Distill-Llama-70B的部署过程及部分小坑


查询NPU及内存命令：
磁盘配置1.查看存储设备[root@bms-910b ~]# lsblk
NAME    MAJ:MIN">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>华为昇腾910b单机部署DeepSeek-R1-Distill-Llama-70B | 你的朋友的博客</title>
    <link rel="icon" type="image/jpeg" href="/images/profile_photo/1.jpeg">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/css/post.css">



    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="你的朋友的博客" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/images/profile_photo/4.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">你的朋友的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/images/profile_photo/4.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">你的朋友的博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/topK-li/topK-li.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/topK-li/topK-li.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/10.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">华为昇腾910b单机部署DeepSeek-R1-Distill-Llama-70B</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/DeepSeek/">
                                <span class="chip bg-color">DeepSeek</span>
                            </a>
                        
                            <a href="/tags/AI/">
                                <span class="chip bg-color">AI</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/AI/" class="post-category">
                                AI
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-03-05
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>华为昇腾8卡910b单机部署DeepSeek-R1-Distill-Llama-70B的部署过程及部分小坑</p>
<span id="more"></span>

<p>查询NPU及内存命令：<br><img src="/images/2025/03/07/a6c0363f-13d8-452f-bee8-38570345d138.png"><br><img src="/images/2025/03/07/5eb4d0eb-655b-437b-90dc-789bfa5cfc16.png"></p>
<h2 id="磁盘配置"><a href="#磁盘配置" class="headerlink" title="磁盘配置"></a>磁盘配置</h2><h4 id="1-查看存储设备"><a href="#1-查看存储设备" class="headerlink" title="1.查看存储设备"></a>1.查看存储设备</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda       <span class="token number">8</span>:0    <span class="token number">0</span>  150G  <span class="token number">0</span> disk 
├─sda1    <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot/efi
└─sda2    <span class="token number">8</span>:2    <span class="token number">0</span>  149G  <span class="token number">0</span> part /
sdb       <span class="token number">8</span>:16   <span class="token number">0</span>  500G  <span class="token number">0</span> disk 
nvme0n1 <span class="token number">259</span>:0    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme4n1 <span class="token number">259</span>:1    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme2n1 <span class="token number">259</span>:2    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme1n1 <span class="token number">259</span>:3    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme3n1 <span class="token number">259</span>:4    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk </code></pre>
<h4 id="2、操作硬盘分区及格式化"><a href="#2、操作硬盘分区及格式化" class="headerlink" title="2、操作硬盘分区及格式化"></a>2、操作硬盘分区及格式化</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/nvme0n1 mklabel gpt</span>
Warning: The existing disk label on /dev/nvme0n1 will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? <span class="token function">yes</span>                                                               
Information: You may need to update /etc/fstab.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># parted /dev/nvme0n1 mkpart primary xfs 0% 100%         </span>
Information: You may ```need to update /etc/fstab.</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs /dev/nvme0n1p1                                </span>
meta-data<span class="token operator">=</span>/dev/nvme0n1p1         <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">195350976</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">rmapbt</span><span class="token operator">=</span><span class="token number">0</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">reflink</span><span class="token operator">=</span><span class="token number">1</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">781403904</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">5</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">381544</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
Discarding blocks<span class="token punctuation">..</span>.Done.</code></pre>
<h4 id="3、查看所有块设备"><a href="#3、查看所有块设备" class="headerlink" title="3、查看所有块设备"></a>3、查看所有块设备</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda           <span class="token number">8</span>:0    <span class="token number">0</span>  150G  <span class="token number">0</span> disk 
├─sda1        <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot/efi
└─sda2        <span class="token number">8</span>:2    <span class="token number">0</span>  149G  <span class="token number">0</span> part /
sdb           <span class="token number">8</span>:16   <span class="token number">0</span>  500G  <span class="token number">0</span> disk 
nvme0n1     <span class="token number">259</span>:0    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
└─nvme0n1p1 <span class="token number">259</span>:6    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> part 
nvme4n1     <span class="token number">259</span>:1    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme2n1     <span class="token number">259</span>:2    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme1n1     <span class="token number">259</span>:3    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk 
nvme3n1     <span class="token number">259</span>:4    <span class="token number">0</span>  <span class="token number">2</span>.9T  <span class="token number">0</span> disk </code></pre>
<h4 id="4、查询块设备信息"><a href="#4、查询块设备信息" class="headerlink" title="4、查询块设备信息"></a>4、查询块设备信息</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># blkid</span>
/dev/sda2: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"fceb329d-eaa2-485b-8507-acb795e6618d"</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">"4096"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"ext4"</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">"7cc21788-7564-4e9d-9ca5-2c155ca9604e"</span>
/dev/sda1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"2A97-A210"</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">"512"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"vfat"</span> <span class="token assign-left variable">PARTLABEL</span><span class="token operator">=</span><span class="token string">"EFI System Partition"</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">"4aa51ffd-2bc9-44c0-a52b-a106f2722467"</span>
/dev/nvme0n1p1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"5f244587-3f94-4e1f-8177-588769947294"</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">"512"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"xfs"</span> <span class="token assign-left variable">PARTLABEL</span><span class="token operator">=</span><span class="token string">"primary"</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">"423a8955-e5cf-4fa2-97d5-a6dc8cba43ca"</span></code></pre>
<h4 id="5、挂载硬盘"><a href="#5、挂载硬盘" class="headerlink" title="5、挂载硬盘"></a>5、挂载硬盘</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /mnt/nvme01</span>
<span class="token punctuation">[</span>root@bms-910b ~<span class="token punctuation">]</span><span class="token comment"># mount -t xfs /dev/nvme0n1p1 /mnt/nvme01</span></code></pre>
<h4 id="6、配置开机自动挂载（加一行有关nvme01的配置）"><a href="#6、配置开机自动挂载（加一行有关nvme01的配置）" class="headerlink" title="6、配置开机自动挂载（加一行有关nvme01的配置）"></a>6、配置开机自动挂载（加一行有关nvme01的配置）</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"UUID=<span class="token variable"><span class="token variable">$(</span>blkid <span class="token parameter variable">-s</span> UUID <span class="token parameter variable">-o</span> value /dev/nvme0n1p1<span class="token variable">)</span></span> /mnt/nvme01 xfs defaults 0 0"</span> <span class="token operator">>></span> /etc/fstab</code></pre>
<p><img src="/images/2025/03/05/413612d2-9d4c-4e02-9a34-677fbe059594.png"></p>
<h2 id="昇腾社区上申请并获取最新的MindIE镜像安装包："><a href="#昇腾社区上申请并获取最新的MindIE镜像安装包：" class="headerlink" title="昇腾社区上申请并获取最新的MindIE镜像安装包："></a>昇腾社区上申请并获取最新的MindIE镜像安装包：</h2><table>
<thead>
<tr>
<th>镜像介绍</th>
<th><a target="_blank" rel="noopener" href="https://www.hiascend.com/developer/ascendhub/detail/af85b724a7e5469ebd7ea13c3439d48f">https://www.hiascend.com/developer/ascendhub/detail/af85b724a7e5469ebd7ea13c3439d48f</a></th>
</tr>
</thead>
<tbody><tr>
<td><strong>镜像申请&#x2F;下载</strong></td>
<td><strong><a target="_blank" rel="noopener" href="https://www.hiascend.com/developer/ascendhub/4%E3%80%81detail/af85b724a7e5469ebd7ea13c3439d48f">https://www.hiascend.com/developer/ascendhub/4、detail/af85b724a7e5469ebd7ea13c3439d48f</a></strong></td>
</tr>
</tbody></table>
<h3 id="容器启动脚本docker-start-sh"><a href="#容器启动脚本docker-start-sh" class="headerlink" title="容器启动脚本docker_start.sh"></a>容器启动脚本<code>docker_start.sh</code></h3><pre class="language-none"><code class="language-none">container_name&#x3D;$1
image_id&#x3D;$2
model_path&#x3D;$3
                                                                                                                                                        
docker run -it --privileged --name&#x3D;$container_name --net&#x3D;host --shm-size&#x3D;500g\
        --device&#x3D;&#x2F;dev&#x2F;davinci_manager \
        --device&#x3D;&#x2F;dev&#x2F;devmm_svm \
        --device&#x3D;&#x2F;dev&#x2F;hisi_hdc \
        -v &#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;driver:&#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;driver \
        -v &#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;add-ons&#x2F;:&#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;add-ons&#x2F; \
        -v &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;:&#x2F;usr&#x2F;local&#x2F;sbin&#x2F; \
        -v &#x2F;var&#x2F;log&#x2F;npu&#x2F;slog&#x2F;:&#x2F;var&#x2F;log&#x2F;npu&#x2F;slog \
        -v &#x2F;var&#x2F;log&#x2F;npu&#x2F;profiling&#x2F;:&#x2F;var&#x2F;log&#x2F;npu&#x2F;profiling \
	-v &#x2F;var&#x2F;log&#x2F;npu&#x2F;dump&#x2F;:&#x2F;var&#x2F;log&#x2F;npu&#x2F;dump \
	-v &#x2F;var&#x2F;log&#x2F;npu&#x2F;:&#x2F;usr&#x2F;slog \
	-v &#x2F;etc&#x2F;hccn.conf:&#x2F;etc&#x2F;hccn.conf \
	-v $model_path:&#x2F;model \
	$image_id \        &#x2F;bin&#x2F;bash
</code></pre>

<table>
<thead>
<tr>
<th>参数</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>–shm-size&#x3D;500g</td>
<td>可能存在容器中共享内存不足的情况，启动容器时需要添加该参数以配置和host宿主机共享内存。</td>
</tr>
<tr>
<td>–name</td>
<td>根据需要自行设定。</td>
</tr>
<tr>
<td>–device</td>
<td>表示映射的设备，可以挂载一个或者多个设备。需要挂载的设备如下：&#x2F;dev&#x2F;davinci_manager：davinci相关的管理设备。&#x2F;dev&#x2F;devmm_svm：内存管理相关设备。&#x2F;dev&#x2F;hisi_hdc：hdc相关管理设备。注：可根据以下命令查询device个数及名称方式，根据需要绑定设备，修改上面命令中的”–device&#x3D;****”。&#96;ll &#x2F;dev&#x2F;</td>
</tr>
<tr>
<td>-v &#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;driver:&#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;driver:ro</td>
<td>将宿主机目录“&#x2F;usr&#x2F;local&#x2F;Ascend&#x2F;driver ”挂载到容器，请根据驱动所在实际路径修改。</td>
</tr>
<tr>
<td>-v &#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;sbin:ro</td>
<td>挂载容器内需要使用的工具。</td>
</tr>
<tr>
<td>-v &#x2F;path-to-weights:&#x2F;path-to-weights:ro</td>
<td>挂载宿主机模型权重所在目录。</td>
</tr>
</tbody></table>
<p>如果不使用<code>--priviliged</code>参数，则需要设置各设备，包括设置想要使用的卡号–device，例如下面为8卡：</p>
<pre class="language-none"><code class="language-none">--name &lt;container-name&gt; \
--device&#x3D;&#x2F;dev&#x2F;davinci_manager \
--device&#x3D;&#x2F;dev&#x2F;hisi_hdc \
--device&#x3D;&#x2F;dev&#x2F;davinci0 \
--device&#x3D;&#x2F;dev&#x2F;davinci1 \
   	--device&#x3D;&#x2F;dev&#x2F;davinci2 \
   	--device&#x3D;&#x2F;dev&#x2F;davinci3 \
  	--device&#x3D;&#x2F;dev&#x2F;davinci4 \
  	--device&#x3D;&#x2F;dev&#x2F;davinci5 \
  	--device&#x3D;&#x2F;dev&#x2F;davinci6 \
--device&#x3D;&#x2F;dev&#x2F;davinci7 \</code></pre>
<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">container_name</span><span class="token operator">=</span>xxx
<span class="token builtin class-name">export</span> <span class="token assign-left variable">image_id</span><span class="token operator">=</span>xxx
<span class="token builtin class-name">export</span> <span class="token assign-left variable">model_path</span><span class="token operator">=</span>xxx
<span class="token function">bash</span> docker_start.sh <span class="token variable">$container_name</span> <span class="token variable">$image_id</span> <span class="token variable">$model_path</span></code></pre>
<h2 id="纯模型测试"><a href="#纯模型测试" class="headerlink" title="纯模型测试"></a>纯模型测试</h2><h4 id="1、进入容器"><a href="#1、进入容器" class="headerlink" title="1、进入容器"></a>1、进入容器</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token variable">$container_name</span> <span class="token function">bash</span></code></pre>
<h4 id="2、配置容器环境变量"><a href="#2、配置容器环境变量" class="headerlink" title="2、配置容器环境变量"></a>2、配置容器环境变量</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /usr/local/Ascend/ascend-toolkit/set_env.sh      <span class="token comment"># 配置 cann 环境变量 </span>
<span class="token builtin class-name">source</span> /usr/local/Ascend/mindie/set_env.sh          <span class="token comment"># 配置 mindie 环境变量 </span>
<span class="token builtin class-name">source</span> /usr/local/Ascend/nnal/atb/set_env.sh    <span class="token comment"># 配置 atb 算子加速库环境变量 </span>
<span class="token builtin class-name">source</span> /usr/local/Ascend/atb-models/set_env.sh  <span class="token comment"># 配置 atb-models 代码仓环境变量</span></code></pre>
<p>进入安装目录：</p>
<pre class="language-none"><code class="language-none">cd &#123;MindIE安装目录&#125;&#x2F;latest</code></pre>
<p>确认目录文件权限是否如下所示，若存在不匹配项，则参考以下命令修改权限。</p>
<pre class="language-none"><code class="language-none">chmod 750 mindie-service
chmod -R 550 mindie-service&#x2F;bin
chmod -R 500 mindie-service&#x2F;bin&#x2F;mindie_llm_backend_connector
chmod 550 mindie-service&#x2F;lib
chmod 440 mindie-service&#x2F;lib&#x2F;*
chmod 550 mindie-service&#x2F;lib&#x2F;grpc
chmod 440 mindie-service&#x2F;lib&#x2F;grpc&#x2F;*
chmod -R 550 mindie-service&#x2F;include
chmod -R 550 mindie-service&#x2F;scripts
chmod 750 mindie-service&#x2F;logs
chmod 750 mindie-service&#x2F;conf
chmod 640 mindie-service&#x2F;conf&#x2F;config.json
chmod 700 mindie-service&#x2F;security
chmod -R 700 mindie-service&#x2F;security&#x2F;*</code></pre>



<h4 id="3、执行对话测试"><a href="#3、执行对话测试" class="headerlink" title="3、执行对话测试"></a>3、执行对话测试</h4><pre class="language-none"><code class="language-none">torchrun --nproc_per_node 8 \
         --master_port 20037 \
         -m examples.run_pa \
         --model_path $&#123;权重路径&#125; \
         --input_texts &#39;What is deep learning?&#39; \
         --max_output_length 20</code></pre>
<h4 id="run-pa-py脚本参数说明"><a href="#run-pa-py脚本参数说明" class="headerlink" title="run_pa.py脚本参数说明"></a><code>run_pa.py</code>脚本参数说明</h4><table>
<thead>
<tr>
<th>参数名称</th>
<th>是否为必选</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>–model_path</td>
<td>是</td>
<td>string</td>
<td>“”</td>
<td>模型权重路径。该路径会进行安全校验，必须使用绝对路径，且和执行推理用户的属组和权限保持一致。</td>
<td></td>
</tr>
<tr>
<td>–input_texts</td>
<td>否</td>
<td>string</td>
<td>“What’s deep learning?”</td>
<td>推理文本或推理文本路径，多条推理文本间使用空格分割。</td>
<td></td>
</tr>
<tr>
<td>–input_ids</td>
<td>否</td>
<td>string</td>
<td>None</td>
<td>推理文本经过模型分词器处理后得到的token id列表，多条推理请求间使用空格分割，单个推理请求内每个token使用逗号隔开。</td>
<td></td>
</tr>
<tr>
<td>–input_file</td>
<td>否</td>
<td>string</td>
<td>None</td>
<td>仅支持jsonl格式文件，每一行必须为List[Dict]格式的按时间顺序排序的对话数据，每个Dict字典中需要至少包含”role”和”content”两个字段。</td>
<td></td>
</tr>
<tr>
<td>–input_dict</td>
<td>否</td>
<td>parse_list_of_json</td>
<td>None</td>
<td>推理文本以及对应的adapter名称。格式形如：’[{“prompt”: “A robe takes 2 bolts of blue fiber and half that much white fiber. How many bolts in total does it take?”, “adapter”: “adapter1”}, {“prompt”: “What is deep learning?”, “adapter”: “base”}]’</td>
<td></td>
</tr>
<tr>
<td>–max_prefill_batch_size</td>
<td>否</td>
<td>int或者None</td>
<td>None</td>
<td>模型推理最大Prefill Batch Size。</td>
<td></td>
</tr>
<tr>
<td>–max_position_embeddings</td>
<td>否</td>
<td>int或者None</td>
<td>None</td>
<td>模型可接受的最大上下文长度。当此值为None时，则从模型权重文件中读取。</td>
<td></td>
</tr>
<tr>
<td>–max_input_length</td>
<td>否</td>
<td>int</td>
<td>1024</td>
<td>推理文本最大token数。</td>
<td></td>
</tr>
<tr>
<td>–max_output_length</td>
<td>否</td>
<td>int</td>
<td>20</td>
<td>推理结果最大token数。</td>
<td></td>
</tr>
<tr>
<td>–max_prefill_tokens</td>
<td>否</td>
<td>int</td>
<td>-1</td>
<td>模型Prefill推理阶段最大可接受的token数。若输入为-1，则max_prefill_tokens &#x3D; max_batch_size * (max_input_length + max_output_length)</td>
<td></td>
</tr>
<tr>
<td>–max_batch_size</td>
<td>否</td>
<td>int</td>
<td>1</td>
<td>模型推理最大batch size。</td>
<td></td>
</tr>
<tr>
<td>–block_size</td>
<td>否</td>
<td>int</td>
<td>128</td>
<td>KV Cache分块存储，每块存储的最大token数，默认为128。</td>
<td></td>
</tr>
<tr>
<td>–chat_template</td>
<td>否</td>
<td>string或者None</td>
<td>None</td>
<td>对话模型的prompt模板。</td>
<td></td>
</tr>
<tr>
<td>–ignore_eos</td>
<td>否</td>
<td>bool</td>
<td>store_true</td>
<td>当推理结果中遇到eos token（句子结束标识符）时，是否结束推理。若传入此参数，则忽略eos token。</td>
<td></td>
</tr>
<tr>
<td>–is_chat_model</td>
<td>否</td>
<td>bool</td>
<td>store_true</td>
<td>是否支持对话模式。若传入此参数，则进入对话模式。</td>
<td></td>
</tr>
<tr>
<td>–is_embedding_model</td>
<td>否</td>
<td>bool</td>
<td>store_true</td>
<td>是否为embedding类模型。默认为因果推断类模型，若传入此参数，则为embedding类模型。</td>
<td></td>
</tr>
<tr>
<td>–load_tokenizer</td>
<td>否</td>
<td>bool</td>
<td>True</td>
<td>是否加载tokenizer。若传入False，则必须传入input_ids参数，且推理输出为token id。</td>
<td></td>
</tr>
<tr>
<td>–enable_atb_torch</td>
<td>否</td>
<td>bool</td>
<td>store_true</td>
<td>是否使用Python组图。默认使用C++组图，若传入此参数，则使用Python组图。</td>
<td></td>
</tr>
<tr>
<td>–kw_args</td>
<td>否</td>
<td>string</td>
<td>“”</td>
<td>扩展参数，支持用户通过扩展参数进行功能扩展。</td>
<td></td>
</tr>
<tr>
<td>–trust_remote_code</td>
<td>否</td>
<td>bool</td>
<td>store_true</td>
<td>是否信任模型权重路径下的自定义代码文件。默认不执行。若传入此参数，则transformers会执行用户权重路径下的自定义代码文件，这些代码文件的功能的安全性需由用户保证，请提前做好安全性检查。</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>说明：<br>run_pa.py脚本用于纯模型快速测试，脚本中未增加强校验，出现异常情况时，会直接抛出异常信息。例如：</p>
<ul>
<li>input_texts、input_ids、input_file、input_dict参数包含推理内容，程序进行数据处理的时间和传入数据量成正比。同时这些输入会被转换成token id搬运至NPU，传入数据量过大可能会导致这些NPU tensor占用显存过大，而出现由out of memory导致的报错信息，例如：”req: xx input length: xx is too long, max_prefill_tokens: xx”等报错信息。</li>
<li>chat_template参数可以使用两种形式输入：模板文本或模板文件的路径。当以模板文本输入时，若文本长度过大，可能会导致运行缓慢。</li>
<li>脚本会基于max_batch_size、max_input_length、max_output_length、max_prefill_batch_size和max_prefill_tokens等参数申请推理输入及KV Cache，若用户传入数值过大，会出现由out of memory导致的报错信息，例如：”RuntimeError: NPU out of memory. Tried to allocate xxx GiB.”。</li>
<li>脚本会基于max_position_embeddings参数，申请旋转位置编码和attention mask等NPU tensor，若用户传入数值过大，会出现由out of memory导致的报错信息，例如：”RuntimeError: NPU out of memory. Tried to allocate xxx GiB.”。</li>
<li>block_size参数若小于张量并行场景下每张卡实际分到的注意力头个数，会出现由shape不匹配导致的报错（”Setup fail, enable log: export ASDOPS_LOG_LEVEL&#x3D;ERROR, export ASDOPS_LOG_TO_STDOUT&#x3D;1 to find the first error. For more details, see the MindIE official document.”），需开启日志查看详细信息。</li>
</ul>
</blockquote>
<h4 id="4、性能测试"><a href="#4、性能测试" class="headerlink" title="4、性能测试"></a>4、性能测试</h4><p>进入ModelTest路径</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ATB_SPEED_HOME_PATH</span>/tests/modeltest/</code></pre>
<p>运行测试脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">bash</span> run.sh pa_<span class="token punctuation">[</span>data_type<span class="token punctuation">]</span> performance <span class="token punctuation">[</span>case_pair<span class="token punctuation">]</span> <span class="token punctuation">[</span>batch_size<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>prefill_batch_size<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>model_name<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>is_chat_model<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>lora <span class="token punctuation">[</span>lora_data_path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>weight_dir<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>trust_remote_code<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>chip_num<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>parallel_params<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>max_position_embedding/max_sequence_length<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>具体执行batch&#x3D;1, 输入长度256, 输出长度256用例的8卡并行性能测试命令如下，</p>
<p>Atlas 800I A2:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">bash</span> run.sh pa_bf16 performance <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">256,256</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token number">1</span> llama <span class="token variable">$&#123;weight_path&#125;</span> <span class="token number">8</span></code></pre>
<p>注：ModelTest为大模型的性能和精度提供测试功能。使用文档请参考${ATB_SPEED_HOME_PATH}&#x2F;tests&#x2F;modeltest&#x2F;README.md</p>
<h2 id="服务化推理"><a href="#服务化推理" class="headerlink" title="服务化推理"></a>服务化推理</h2><p>打开配置文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /usr/local/Ascend/mindie/latest/mindie-service/conf/config.json</code></pre>
<p>修改配置文件，<code>config.json</code>参考配置如下：<br><a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindie/100/mindieservice/servicedev/mindie_service0285.html">配置参数说明</a></p>
<pre class="language-none"><code class="language-none">&#123;
    &quot;Version&quot;: &quot;1.0.0&quot;,
    &quot;LogConfig&quot; :
    &#123;
        &quot;logLevel&quot; : &quot;Info&quot;,
        &quot;logFileSize&quot; : 20,
        &quot;logFileNum&quot; : 20,
        &quot;logPath&quot; : &quot;logs&#x2F;mindservice.log&quot;
    &#125;,

    &quot;ServerConfig&quot; :
    &#123;
        &quot;ipAddress&quot; : &quot;127.0.0.1&quot;,
        &quot;managementIpAddress&quot;: &quot;127.0.0.2&quot;,
        &quot;port&quot; : 1025,
        &quot;managementPort&quot; : 1026,
        &quot;metricsPort&quot; : 1027,
        &quot;allowAllZeroIpListening&quot; : false,
        &quot;maxLinkNum&quot; : 1000,
        &quot;httpsEnabled&quot; : true,
        &quot;fullTextEnabled&quot; : false,
        &quot;tlsCaPath&quot; : &quot;security&#x2F;ca&#x2F;&quot;,
        &quot;tlsCaFile&quot; : [&quot;ca.pem&quot;],
        &quot;tlsCert&quot; : &quot;security&#x2F;certs&#x2F;server.pem&quot;,
        &quot;tlsPk&quot; : &quot;security&#x2F;keys&#x2F;server.key.pem&quot;,
        &quot;tlsPkPwd&quot; : &quot;security&#x2F;pass&#x2F;key_pwd.txt&quot;,
        &quot;tlsCrlPath&quot; : &quot;security&#x2F;certs&#x2F;&quot;,
        &quot;tlsCrlFiles&quot; : [&quot;server_crl.pem&quot;],
        &quot;managementTlsCaFile&quot; : [&quot;management_ca.pem&quot;],
        &quot;managementTlsCert&quot; : &quot;security&#x2F;certs&#x2F;management&#x2F;server.pem&quot;,
        &quot;managementTlsPk&quot; : &quot;security&#x2F;keys&#x2F;management&#x2F;server.key.pem&quot;,
        &quot;managementTlsPkPwd&quot; : &quot;security&#x2F;pass&#x2F;management&#x2F;key_pwd.txt&quot;,
        &quot;managementTlsCrlPath&quot; : &quot;security&#x2F;management&#x2F;certs&#x2F;&quot;,
        &quot;managementTlsCrlFiles&quot; : [&quot;server_crl.pem&quot;],
        &quot;kmcKsfMaster&quot; : &quot;tools&#x2F;pmt&#x2F;master&#x2F;ksfa&quot;,
        &quot;kmcKsfStandby&quot; : &quot;tools&#x2F;pmt&#x2F;standby&#x2F;ksfb&quot;,
        &quot;inferMode&quot; : &quot;standard&quot;,
        &quot;interCommTLSEnabled&quot; : true,
        &quot;interCommPort&quot; : 1121,
        &quot;interCommTlsCaPath&quot; : &quot;security&#x2F;grpc&#x2F;ca&#x2F;&quot;,
        &quot;interCommTlsCaFiles&quot; : [&quot;ca.pem&quot;],
        &quot;interCommTlsCert&quot; : &quot;security&#x2F;grpc&#x2F;certs&#x2F;server.pem&quot;,
        &quot;interCommPk&quot; : &quot;security&#x2F;grpc&#x2F;keys&#x2F;server.key.pem&quot;,
        &quot;interCommPkPwd&quot; : &quot;security&#x2F;grpc&#x2F;pass&#x2F;key_pwd.txt&quot;,
        &quot;interCommTlsCrlPath&quot; : &quot;security&#x2F;grpc&#x2F;certs&#x2F;&quot;,
        &quot;interCommTlsCrlFiles&quot; : [&quot;server_crl.pem&quot;],
        &quot;openAiSupport&quot; : &quot;vllm&quot;
    &#125;,

    &quot;BackendConfig&quot;: &#123;
        &quot;backendName&quot; : &quot;mindieservice_llm_engine&quot;,
        &quot;modelInstanceNumber&quot; : 1,
        &quot;npuDeviceIds&quot; : [[0,1,2,3]],
        &quot;tokenizerProcessNumber&quot; : 8,
        &quot;multiNodesInferEnabled&quot;: false,
        &quot;multiNodesInferPort&quot;: 1120,
        &quot;interNodeTLSEnabled&quot;: true,
        &quot;interNodeTlsCaPath&quot;: &quot;security&#x2F;grpc&#x2F;ca&#x2F;&quot;,
        &quot;interNodeTlsCaFiles&quot;: [&quot;ca.pem&quot;],
        &quot;interNodeTlsCert&quot;: &quot;security&#x2F;grpc&#x2F;certs&#x2F;server.pem&quot;,
        &quot;interNodeTlsPk&quot;: &quot;security&#x2F;grpc&#x2F;keys&#x2F;server.key.pem&quot;,
        &quot;interNodeTlsPkPwd&quot;: &quot;security&#x2F;grpc&#x2F;pass&#x2F;mindie_server_key_pwd.txt&quot;,
        &quot;interNodeTlsCrlPath&quot; : &quot;security&#x2F;grpc&#x2F;certs&#x2F;&quot;,
        &quot;interNodeTlsCrlfiles&quot; : [&quot;server_crl.pem&quot;],
        &quot;interNodeKmcKsfMaster&quot;: &quot;tools&#x2F;pmt&#x2F;master&#x2F;ksfa&quot;,
        &quot;interNodeKmcKsfStandby&quot;: &quot;tools&#x2F;pmt&#x2F;standby&#x2F;ksfb&quot;,
        &quot;ModelDeployConfig&quot;:
        &#123;
            &quot;maxSeqLen&quot; : 2560,
            &quot;maxInputTokenLen&quot; : 2048,
            &quot;truncation&quot; : false,
            &quot;ModelConfig&quot; : [
                &#123;
                    &quot;modelInstanceType&quot;: &quot;Standard&quot;,
                    &quot;modelName&quot; : &quot;DeepSeek-R1-Distill-Llama-70B&quot;,
                    &quot;modelWeightPath&quot; : &quot;&#x2F;data&#x2F;atb_testdata&#x2F;weights&#x2F;llama1-65b-safetensors&quot;,
                    &quot;worldSize&quot; : 4,
                    &quot;cpuMemSize&quot; : 5,
                    &quot;npuMemSize&quot; : -1,
                    &quot;backendType&quot;: &quot;atb&quot;,
                    &quot;trustRemoteCode&quot;: false
                &#125;
            ]
        &#125;,

        &quot;ScheduleConfig&quot;:
        &#123;
            &quot;templateType&quot;: &quot;Standard&quot;,
            &quot;templateName&quot; : &quot;Standard_LLM&quot;,
            &quot;cacheBlockSize&quot; : 128,

            &quot;maxPrefillBatchSize&quot; : 50,
            &quot;maxPrefillTokens&quot; : 8192,
            &quot;prefillTimeMsPerReq&quot; : 150,
            &quot;prefillPolicyType&quot; : 0,

            &quot;decodeTimeMsPerReq&quot; : 50,
            &quot;decodePolicyType&quot; : 0,

            &quot;maxBatchSize&quot; : 200,
            &quot;maxIterTimes&quot; : 512,
            &quot;maxPreemptCount&quot; : 0,
            &quot;supportSelectBatch&quot; : false,
            &quot;maxQueueDelayMicroseconds&quot; : 5000
        &#125;
    &#125;
&#125;</code></pre>
<p>启动服务。启动命令需在&#x2F;{MindIE安装目录}&#x2F;latest&#x2F;mindie-service目录中执行。</p>
<p>（推荐）使用后台进程方式启动服务。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">nohup</span> ./bin/mindieservice_daemon <span class="token operator">></span> output.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tail</span> <span class="token parameter variable">-f</span> output.log</code></pre>
<p>在标准输出流捕获到的文件中，打印如下信息说明启动成功。</p>
<pre class="language-none"><code class="language-none">Daemon start success!</code></pre>
<p>直接启动服务。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">./bin/mindieservice_daemon</code></pre>
<p>回显如下则说明启动成功。</p>
<pre class="language-none"><code class="language-none">Daemon start success!</code></pre>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>目前 MindIE-Service 的 API 接口兼容 <a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/text-generation">OpenAI</a>、 <a target="_blank" rel="noopener" href="https://docs.vllm.ai/en/latest/getting_started/examples/api_client.html">vLLM</a>、<a target="_blank" rel="noopener" href="https://huggingface.github.io/text-generation-inference/">HuggingFace Text Generation Inference</a> 、<a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/protocol/extension_generate.html">NVIDIA Triton Inference Server</a> 推理框架。<br>OpenAI: <code>/v1/chat/completions</code><br>vLLM: <code>/generate</code><br>HuggingFace TGI: <code>/generate</code>、<code>/generate_stream</code><br>NVIDIA Triton Inference Server：<br><code>/v2/models/$&#123;MODEL_NAME&#125;[/versions/$&#123;MODEL_VERSION&#125;]/infer</code><br><code>v2/models/$&#123;MODEL_NME&#125;[/versions/$&#123;MODEL_VERSION&#125;]/generate</code><br><code>v2/models/$&#123;MODEL_NAME&#125;[/versions/$&#123;MODEL_VERSION&#125;]/generate_stream</code></p>
<p>新建窗口测试(VLLM接口)</p>
<pre class="language-none"><code class="language-none">curl 127.0.0.1:1025&#x2F;generate -d &#39;&#123;
&quot;prompt&quot;: &quot;西红柿炒鸡蛋怎么做?&quot;,
&quot;max_tokens&quot;: 128,
&quot;stream&quot;: false,
&quot;do_sample&quot;:true,
&quot;repetition_penalty&quot;: 1.00,
&quot;temperature&quot;: 0.01,
&quot;top_p&quot;: 0.001,
&quot;top_k&quot;: 1,
&quot;model&quot;: &quot;DeepSeek-R1-Distill-Llama-70B&quot;
&#125;&#39;</code></pre>
<p>OpenAI格式接口</p>
<pre class="language-none"><code class="language-none">curl &quot;http:&#x2F;&#x2F;127.0.0.1:1025&#x2F;v1&#x2F;chat&#x2F;completions&quot; \
  -H &quot;Content-Type: application&#x2F;json&quot; \
  -d &#39;&#123;
    &quot;model&quot;: &quot;DeepSeek-R1-Distill-Llama-70B&quot;,
    &quot;messages&quot;: [
      &#123;
        &quot;role&quot;: &quot;user&quot;,
        &quot;content&quot;: &quot;西红柿炒鸡蛋怎么做？&quot;
      &#125;
    ],
    &quot;max_tokens&quot;:128
  &#125;&#39;</code></pre>
<h2 id="接入MaxKB"><a href="#接入MaxKB" class="headerlink" title="接入MaxKB"></a>接入MaxKB</h2><p>MaxKB部署参考<a target="_blank" rel="noopener" href="https://maxkb.cn/docs/">官方文档</a></p>
<p>根据<code>config.json</code>配置文件中<code>&quot;openAiSupport&quot;</code>字段确认接口方式，此处为 <code>&quot;vllm&quot;</code><br>选择vllm<br><img src="/images/2025/03/12/c890a1db-7597-4730-8097-23caca57312b.png"></p>
<p>输入<code>&quot;modelName&quot; : &quot;DeepSeek-R1-Distill-Llama-70B&quot;,</code>设置的模型名称，输入url，apikey随便填，然后保存使用即可。</p>
<p><img src="/images/2025/03/12/e4bf5af9-82b9-4c71-bc58-c803bd1d955a.png"></p>
<h2 id="奇怪的问题"><a href="#奇怪的问题" class="headerlink" title="奇怪的问题"></a>奇怪的问题</h2><h4 id="DeepSeek输出时前标签丢失，在输出时只有"><a href="#DeepSeek输出时前标签丢失，在输出时只有" class="headerlink" title="DeepSeek输出时前&lt;think&gt;标签丢失，在输出时只有&lt;/think&gt;"></a>DeepSeek输出时前<code>&lt;think&gt;</code>标签丢失，在输出时只有<code>&lt;/think&gt;</code></h4><p><img src="/images/2025/03/12/3a8a5747-53fa-4a89-9891-7c56f19d9a2f.png"><br>已知为BUG，需修改下载模型中的<code>tokenizer_config.json</code>，参考<a target="_blank" rel="noopener" href="https://github.com/vllm-project/vllm/issues/13125">Issue-13125</a><br><code>tokenizer_config.json</code>:</p>
<pre class="language-none"><code class="language-none">&#123;
  &quot;add_bos_token&quot;: true,
  &quot;add_eos_token&quot;: false,
  &quot;bos_token&quot;: &#123;
    &quot;__type&quot;: &quot;AddedToken&quot;,
    &quot;content&quot;: &quot;&lt;｜begin▁of▁sentence｜&gt;&quot;,
    &quot;lstrip&quot;: false,
    &quot;normalized&quot;: true,
    &quot;rstrip&quot;: false,
    &quot;single_word&quot;: false
  &#125;,
  &quot;clean_up_tokenization_spaces&quot;: false,
  &quot;eos_token&quot;: &#123;
    &quot;__type&quot;: &quot;AddedToken&quot;,
    &quot;content&quot;: &quot;&lt;｜end▁of▁sentence｜&gt;&quot;,
    &quot;lstrip&quot;: false,
    &quot;normalized&quot;: true,
    &quot;rstrip&quot;: false,
    &quot;single_word&quot;: false
  &#125;,
  &quot;legacy&quot;: true,
  &quot;model_max_length&quot;: 16384,
  &quot;pad_token&quot;: &#123;
    &quot;__type&quot;: &quot;AddedToken&quot;,
    &quot;content&quot;: &quot;&lt;｜end▁of▁sentence｜&gt;&quot;,
    &quot;lstrip&quot;: false,
    &quot;normalized&quot;: true,
    &quot;rstrip&quot;: false,
    &quot;single_word&quot;: false
  &#125;,
  &quot;sp_model_kwargs&quot;: &#123;&#125;,
  &quot;unk_token&quot;: null,
  &quot;tokenizer_class&quot;: &quot;LlamaTokenizerFast&quot;,
  &quot;chat_template&quot;: &quot;&#123;% if not add_generation_prompt is defined %&#125;&#123;% set add_generation_prompt &#x3D; false %&#125;&#123;% endif %&#125;&#123;% set ns &#x3D; namespace(is_first&#x3D;false, is_tool&#x3D;false, is_output_first&#x3D;true, system_prompt&#x3D;&#39;&#39;) %&#125;&#123;%- for message in messages %&#125;&#123;%- if message[&#39;role&#39;] &#x3D;&#x3D; &#39;system&#39; %&#125;&#123;% set ns.system_prompt &#x3D; message[&#39;content&#39;] %&#125;&#123;%- endif %&#125;&#123;%- endfor %&#125;&#123;&#123;bos_token&#125;&#125;&#123;&#123;ns.system_prompt&#125;&#125;&#123;%- for message in messages %&#125;&#123;%- if message[&#39;role&#39;] &#x3D;&#x3D; &#39;user&#39; %&#125;&#123;%- set ns.is_tool &#x3D; false -%&#125;&#123;&#123;&#39;&lt;｜User｜&gt;&#39; + message[&#39;content&#39;]&#125;&#125;&#123;%- endif %&#125;&#123;%- if message[&#39;role&#39;] &#x3D;&#x3D; &#39;assistant&#39; and message[&#39;content&#39;] is none %&#125;&#123;%- set ns.is_tool &#x3D; false -%&#125;&#123;%- for tool in message[&#39;tool_calls&#39;]%&#125;&#123;%- if not ns.is_first %&#125;&#123;&#123;&#39;&lt;｜Assistant｜&gt;&lt;｜tool▁calls▁begin｜&gt;&lt;｜tool▁call▁begin｜&gt;&#39; + tool[&#39;type&#39;] + &#39;&lt;｜tool▁sep｜&gt;&#39; + tool[&#39;function&#39;][&#39;name&#39;] + &#39;\\n&#39; + &#39;&#96;&#96;&#96;json&#39; + &#39;\\n&#39; + tool[&#39;function&#39;][&#39;arguments&#39;] + &#39;\\n&#39; + &#39;&#96;&#96;&#96;&#39; + &#39;&lt;｜tool▁call▁end｜&gt;&#39;&#125;&#125;&#123;%- set ns.is_first &#x3D; true -%&#125;&#123;%- else %&#125;&#123;&#123;&#39;\\n&#39; + &#39;&lt;｜tool▁call▁begin｜&gt;&#39; + tool[&#39;type&#39;] + &#39;&lt;｜tool▁sep｜&gt;&#39; + tool[&#39;function&#39;][&#39;name&#39;] + &#39;\\n&#39; + &#39;&#96;&#96;&#96;json&#39; + &#39;\\n&#39; + tool[&#39;function&#39;][&#39;arguments&#39;] + &#39;\\n&#39; + &#39;&#96;&#96;&#96;&#39; + &#39;&lt;｜tool▁call▁end｜&gt;&#39;&#125;&#125;&#123;&#123;&#39;&lt;｜tool▁calls▁end｜&gt;&lt;｜end▁of▁sentence｜&gt;&#39;&#125;&#125;&#123;%- endif %&#125;&#123;%- endfor %&#125;&#123;%- endif %&#125;&#123;%- if message[&#39;role&#39;] &#x3D;&#x3D; &#39;assistant&#39; and message[&#39;content&#39;] is not none %&#125;&#123;%- if ns.is_tool %&#125;&#123;&#123;&#39;&lt;｜tool▁outputs▁end｜&gt;&#39; + message[&#39;content&#39;] + &#39;&lt;｜end▁of▁sentence｜&gt;&#39;&#125;&#125;&#123;%- set ns.is_tool &#x3D; false -%&#125;&#123;%- else %&#125;&#123;% set content &#x3D; message[&#39;content&#39;] %&#125;&#123;% if &#39;&lt;&#x2F;think&gt;&#39; in content %&#125;&#123;% set content &#x3D; content.split(&#39;&lt;&#x2F;think&gt;&#39;)[-1] %&#125;&#123;% endif %&#125;&#123;&#123;&#39;&lt;｜Assistant｜&gt;&#39; + content + &#39;&lt;｜end▁of▁sentence｜&gt;&#39;&#125;&#125;&#123;%- endif %&#125;&#123;%- endif %&#125;&#123;%- if message[&#39;role&#39;] &#x3D;&#x3D; &#39;tool&#39; %&#125;&#123;%- set ns.is_tool &#x3D; true -%&#125;&#123;%- if ns.is_output_first %&#125;&#123;&#123;&#39;&lt;｜tool▁outputs▁begin｜&gt;&lt;｜tool▁output▁begin｜&gt;&#39; + message[&#39;content&#39;] + &#39;&lt;｜tool▁output▁end｜&gt;&#39;&#125;&#125;&#123;%- set ns.is_output_first &#x3D; false %&#125;&#123;%- else %&#125;&#123;&#123;&#39;\\n&lt;｜tool▁output▁begin｜&gt;&#39; + message[&#39;content&#39;] + &#39;&lt;｜tool▁output▁end｜&gt;&#39;&#125;&#125;&#123;%- endif %&#125;&#123;%- endif %&#125;&#123;%- endfor -%&#125;&#123;% if ns.is_tool %&#125;&#123;&#123;&#39;&lt;｜tool▁outputs▁end｜&gt;&#39;&#125;&#125;&#123;% endif %&#125;&#123;% if add_generation_prompt and not ns.is_tool %&#125;&#123;&#123;&#39;&lt;｜Assistant｜&gt;&#39;&#125;&#125;&#123;% endif %&#125;&quot;
&#125;</code></pre>

<h4 id="ollma丢失"><a href="#ollma丢失" class="headerlink" title="ollma丢失&lt;think&gt;"></a>ollma丢失<code>&lt;think&gt;</code></h4><p>参考<a target="_blank" rel="noopener" href="https://github.com/ollama/ollama/issues/8965">Issue-8965</a>，注意核对模型</p>
<pre class="language-none"><code class="language-none">FROM &quot;jp_calibration&#x2F;DeepSeek-R1-Distill-Qwen-32B-Q5_K_S-jp.gguf&quot;

PARAMETER stop &quot;&lt;｜begin▁of▁sentence｜&gt;&quot;
PARAMETER stop &quot;&lt;｜end▁of▁sentence｜&gt;&quot;
PARAMETER stop &quot;&lt;｜User｜&gt;&quot;
PARAMETER stop &quot;&lt;｜Assistant｜&gt;&quot;


PARAMETER temperature 0.5
PARAMETER top_k 40
PARAMETER top_p 0.95
PARAMETER repeat_penalty 1.1
PARAMETER repeat_last_n 64

SYSTEM &quot;&quot;&quot;
The user asks a question, and the Assistant solves it. The assistant first thinks about the reasoning process in the mind and then provides the user with the answer.
The reasoning process and answer are enclosed within &lt;think&gt; &lt;&#x2F;think&gt; and &lt;answer&gt; &lt;&#x2F;answer&gt; tags, respectively, i.e., &lt;think&gt; reasoning process here &lt;&#x2F;think&gt; &lt;answer&gt; answer here &lt;&#x2F;answer&gt;
If the user&#39;s question is math related, please put your final answer within \\boxed&#123;&#123;&#125;&#125;.
&quot;&quot;&quot;

TEMPLATE &quot;&quot;&quot;
&#123;&#123;- if .System &#125;&#125;&#123;&#123; .System &#125;&#125;&#123;&#123; end &#125;&#125;
&#123;&#123;- range $i, $_ :&#x3D; .Messages &#125;&#125;
&#123;&#123;- $last :&#x3D; eq (len (slice $.Messages $i)) 1&#125;&#125;
&#123;&#123;- if eq .Role &quot;user&quot; &#125;&#125;&lt;｜User｜&gt;&#123;&#123; .Content &#125;&#125;
&#123;&#123;- else if eq .Role &quot;assistant&quot; &#125;&#125;&lt;｜Assistant｜&gt;&#123;&#123; .Content &#125;&#125;&#123;&#123;- if not $last &#125;&#125;&lt;｜end▁of▁sentence｜&gt;&#123;&#123;- end &#125;&#125;
&#123;&#123;- end &#125;&#125;
&#123;&#123;- if and $last (ne .Role &quot;assistant&quot;) &#125;&#125;&lt;｜Assistant｜&gt;&#123;&#123;- end &#125;&#125;
&#123;&#123;- end -&#125;&#125;
&quot;&quot;&quot;</code></pre>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">你的朋友</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://topk-li.github.io/2025/03/05/hua-wei-sheng-teng-910b-dan-ji-bu-shu-deepseek-r1-distill-llama-70b/">https://topk-li.github.io/2025/03/05/hua-wei-sheng-teng-910b-dan-ji-bu-shu-deepseek-r1-distill-llama-70b/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">你的朋友</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/DeepSeek/">
                                    <span class="chip bg-color">DeepSeek</span>
                                </a>
                            
                                <a href="/tags/AI/">
                                    <span class="chip bg-color">AI</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/03/12/zai-hai-guang-dcu-k100-ai-4-shang-shi-yong-ollama-he-vllm-fen-bie-bu-shu-qwq-32b-deepseek/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="在海光DCU-K100-AI-4上使用ollama和vLLM分别部署qwq-32B、DeepSeek">
                        
                        <span class="card-title">在海光DCU-K100-AI-4上使用ollama和vLLM分别部署qwq-32B、DeepSeek</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-03-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/AI/" class="post-category">
                                    AI
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/DeepSeek/">
                        <span class="chip bg-color">DeepSeek</span>
                    </a>
                    
                    <a href="/tags/AI/">
                        <span class="chip bg-color">AI</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/09/14/jian-kong-fu-wu-qi-jin-cheng-nei-cun-shi-yong-hui-zhi-zhe-xian-tu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/23.jpg" class="responsive-img" alt="监控服务器进程内存使用，绘制折线图">
                        
                        <span class="card-title">监控服务器进程内存使用，绘制折线图</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            排查问题自用小监控
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-09-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" class="post-category">
                                    运维笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E8%BF%90%E7%BB%B4/">
                        <span class="chip bg-color">运维</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2020-2025</span>
            
            <a href="/about" target="_blank">你的朋友</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:topk_an@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://topk-li.github.io"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
